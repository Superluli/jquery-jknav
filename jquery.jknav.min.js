/*
 jknav
 @name      jquery.jknav.js
 @author    Yu-Jie Lin
 @version   0.5.1
 @date      2013-03-26
 @copyright (c) 2010-2013 Yu-Jie Lin <livibetter@gmail.com>
 @license   MIT License
 @homepage  https://github.com/livibetter/jquery-jknav
 @example   http://livibetter.github.com/jquery-jknav/jquery.jknav.demo.html
*/
(function(a){function g(d){var b=window.console;a.jknav.DEBUG&&(b&&b.log)&&b.log("jknav: "+d)}function j(d,b){if("input"==d.target.tagName.toLowerCase()||"button"==d.target.tagName.toLowerCase()||"select"==d.target.tagName.toLowerCase()||"textarea"==d.target.tagName.toLowerCase())g("keyup: "+d.target.tagName+", target is INPUT ignored.");else{var e=String.fromCharCode(d.keyCode).toLowerCase();g("keyup: "+d.target.tagName+", key: "+e);if(e==b.up.toLowerCase()||e==b.down.toLowerCase()){b.reevaluate&&
(a.jknav.index[b.name]=null);var h;a:{var e=e==b.down.toLowerCase()?1:-1,c=a.jknav.index[b.name];g("Calculating index for "+b.name+", current index = "+c);if(null==c){var f=a(a.jknav.TARGET).scrollTop();g(a.jknav.TARGET+" top = "+f);a.each(a.jknav.items[b.name],function(b,d){var e=Math.floor(a(d).offset().top);f>=e&&(c=b)});null==c?c=0<e?0:a.jknav.items[b.name].length-1:0<e&&++c>=a.jknav.items[b.name].length?c=0:0>e&&(f==Math.floor(a(a.jknav.items[b.name][c]).offset().top)&&0>--c)&&(c=a.jknav.items[b.name].length-
1)}else{if(!b.circular&&(0==c&&-1==e||c==a.jknav.items[b.name].length-1&&1==e)){h=c;break a}c+=e;c>=a.jknav.items[b.name].length&&(c=0);0>c&&(c=a.jknav.items[b.name].length-1)}g("new index = "+c);h=a.jknav.index[b.name]=c}e=a(a.jknav.items[b.name][h][0]);a(a.jknav.TARGET).animate({scrollLeft:Math.floor(e.offset().left),scrollTop:Math.floor(e.offset().top)},b.speed,b.easing,function(){var c=a.jknav.items[b.name][h][1];c&&c(a.jknav.items[b.name][h][0])})}}}a.fn.jknav=function(d,b){null==b&&(b="default");
null==a.jknav.items[b]&&(a.jknav.items[b]=[]);return this.each(function(){a.jknav.items[b].push([this,d]);a.jknav.items[b].sort(function(b,d){var c=a(b[0]).offset().top,f=a(d[0]).offset().top;if(c<f)return-1;if(c>f)return 1;if(c==f)return c=a(b[0]).offset().left,f=a(d[0]).offset().left,c<f?-1:c>f?1:0})})};a.jknav={index:{},items:{},opts:{},default_options:{up:"k",down:"j",name:"default",easing:"swing",speed:"normal",circular:!0,reevaluate:!1},DEBUG:!1,TARGET_KEYUP:"html",TARGET:!a.browser.webkit?
"html":"body",init:function(d){var b=a.extend(a.extend({},a.jknav.default_options),d);a.jknav.index[b.name]=null;a.jknav.opts[b.name]=b;a(a.jknav.TARGET_KEYUP).keyup(function(a){j(a,b)});g('new set "'+b.name+'" initialzed.')},up:function(d){d=a.jknav.opts[d||"default"];j({target:{tagName:""},keyCode:d.up.charCodeAt(0)},d)},down:function(d){d=a.jknav.opts[d||"default"];j({target:{tagName:""},keyCode:d.down.charCodeAt(0)},d)}}})(jQuery);
